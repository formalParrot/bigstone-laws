<style>
  /* Role colors filled */
  .role-judge { background-color: #1f77b4; }
  .role-jury { background-color: #ff7f0e; }
  .role-plaintiff { background-color: #2ca02c; }
  .role-plaintiff-attorney { background-color: #d62728; }
  .role-defendant { background-color: #9467bd; }
  .role-defendant-attorney { background-color: #8c564b; }
  .role-witness { background-color: #e377c2; }

  /* Circular role badge */
  .role-badge {
    display: inline-block;
    padding: 2px 8px;
    margin-left: 5px;
    font-size: 0.75em;
    font-weight: bold;
    border-radius: 12px; /* Changed from 50% to a specific pixel value for an oval shape */
    text-align: center;
    line-height: 1.2em;
    color: white;
    white-space: nowrap;
  }

  /* Chat messages styling */
  ul.court-messages { list-style: none; padding-left: 0; }
  ul.court-messages li { display: flex; align-items: flex-start; margin-bottom: 1em; }
  ul.court-messages img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; }
  ul.court-messages strong { font-weight: bold; }

  /* Modal for media */
  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
  .modal-content { background-color: #fefefe; padding: 20px; border: 1px solid #888; max-width: 90%; max-height: 90%; display: flex; flex-direction: column; position: relative; }
  .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
  .close-button:hover, .close-button:focus { color: black; text-decoration: none; }
  .media-container { max-width: 100%; max-height: 100%; display: flex; justify-content: center; align-items: center; }
  .media-container img, .media-container video { max-width: 100%; max-height: 100%; transition: transform 0.2s; }
  .zoom-controls { display: flex; justify-content: center; margin-top: 10px; gap: 10px; }
  .zoom-controls button { background-color: #444; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; }
</style>

<ul class="court-messages">
  {% assign slug = page.path | split: '/' | last | split: '.' | first %}
  {% assign messages = site.data.court_proceedings[slug] %}

  {% for msg in messages %}
    {% unless msg.senderName contains "[System]" %}
      {% assign username_clean = msg.senderName | strip %}
      {% assign avatar_username = username_clean | downcase | replace: " ", "_" %}

      {% assign roles = "" | split: "," %}
      {% if username_clean == page.judge %}{% assign roles = roles | push: "role-judge" %}{% endif %}
      {% if page.jury contains username_clean %}{% assign roles = roles | push: "role-jury" %}{% endif %}
      {% if username_clean == page.plaintiff %}{% assign roles = roles | push: "role-plaintiff" %}{% endif %}
      {% if username_clean == page.plaintiff_attorney %}{% assign roles = roles | push: "role-plaintiff-attorney" %}{% endif %}
      {% if username_clean == page.defendant %}{% assign roles = roles | push: "role-defendant" %}{% endif %}
      {% if username_clean == page.defendant_attorney %}{% assign roles = roles | push: "role-defendant-attorney" %}{% endif %}
      {% if page.witnesses contains username_clean %}{% assign roles = roles | push: "role-witness" %}{% endif %}

      <li>
        <img src="https://mc-heads.net/avatar/{{ avatar_username }}" alt="{{ username_clean }}'s avatar">
        <div>
          <strong>{{ username_clean }}</strong>
          {% for role in roles %}
            <span class="role-badge {{ role }}">{{ role | remove: "role-" | replace: "-", " " | capitalize }}</span>
          {% endfor %}
          {% if msg.timestamp %}
            <span style="color: #555; font-size: 0.85em;">[{{ msg.timestamp | date: "%Y-%m-%d %H:%M" }}]</span>
          {% endif %}
          {% if msg.message %}
            <div style="margin-top: 0.2em;">{{ msg.message }}</div>
          {% endif %}
        </div>
      </li>
    {% endunless %}
  {% endfor %}
</ul>

<div id="mediaModal" class="modal">
  <span class="close-button" onclick="closeModal()">&times;</span>
  <div class="modal-content">
    <div id="media-content" class="media-container"></div>
    <div id="zoomControls" class="zoom-controls" style="display:none;">
      <button onclick="zoomOut()">-</button>
      <button onclick="zoomIn()">+</button>
    </div>
  </div>
</div>

<script>
let currentZoom = 1;
const zoomStep = 0.2;

function openModal(url, isImage, isVideo) {
  const modal = document.getElementById("mediaModal");
  const mediaContainer = document.getElementById("media-content");
  const zoomControls = document.getElementById("zoomControls");
  mediaContainer.innerHTML = "";
  currentZoom = 1;

  if (isImage) {
    const img = document.createElement("img");
    img.src = url;
    mediaContainer.appendChild(img);
    zoomControls.style.display = "flex";
  } else if (isVideo) {
    const video = document.createElement("video");
    video.src = url;
    video.controls = true;
    mediaContainer.appendChild(video);
    zoomControls.style.display = "none";
  }

  modal.style.display = "flex";
}

function closeModal() {
  document.getElementById("mediaModal").style.display = "none";
  document.getElementById("media-content").innerHTML = "";
}

function zoomIn() {
  currentZoom += zoomStep;
  applyZoom();
}

function zoomOut() {
  if (currentZoom > zoomStep) {
    currentZoom -= zoomStep;
    applyZoom();
  }
}

function applyZoom() {
  const media = document.querySelector("#media-content img, #media-content video");
  if (media) {
    media.style.transform = `scale(${currentZoom})`;
  }
}

window.onclick = function(event) {
  const modal = document.getElementById("mediaModal");
  if (event.target === modal) {
    closeModal();
  }
}
</script>